<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Kondisi Lapangan</title>
    <style>
        /* CSS yang sudah ada */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 100%;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        /* Tambahan untuk memastikan tampilan sesuai mobile */
        .camera-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            z-index: 1000;
            display: none;
        }
        
        .camera-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Konten form Anda yang sudah ada -->
        
        <button id="openCamera" class="btn">
            <i class="material-icons">photo_camera</i>
            <span>Ambil Foto</span>
        </button>
        
        <!-- Modal Kamera -->
        <div id="cameraModal" class="camera-modal">
            <video id="cameraPreview" class="camera-preview" autoplay playsinline></video>
            <button id="captureBtn" style="position:absolute; bottom:20px; left:50%; transform:translateX(-50%);">
                Ambil Foto
            </button>
            <button id="closeCamera" style="position:absolute; top:20px; right:20px;">
                X
            </button>
        </div>
    </div>

    <script>
    // Kode JavaScript yang sudah ada dengan penyesuaian
    document.getElementById('openCamera').addEventListener('click', function() {
        // Meminta izin kamera
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
            .then(function(stream) {
                var cameraModal = document.getElementById('cameraModal');
                var cameraPreview = document.getElementById('cameraPreview');
                
                cameraPreview.srcObject = stream;
                cameraModal.style.display = 'block';
                
                // Handler untuk tombol close
                document.getElementById('closeCamera').addEventListener('click', function() {
                    stream.getTracks().forEach(track => track.stop());
                    cameraModal.style.display = 'none';
                });
                
                // Handler untuk tombol capture
                document.getElementById('captureBtn').addEventListener('click', function() {
                    // Kode untuk mengambil foto
                    var canvas = document.createElement('canvas');
                    canvas.width = cameraPreview.videoWidth;
                    canvas.height = cameraPreview.videoHeight;
                    var ctx = canvas.getContext('2d');
                    ctx.drawImage(cameraPreview, 0, 0, canvas.width, canvas.height);
                    
                    // Konversi ke blob dan simpan
                    canvas.toBlob(function(blob) {
                        // Simpan ke IndexedDB atau tampilkan preview
                        console.log('Foto diambil:', blob);
                        
                        // Tutup kamera
                        stream.getTracks().forEach(track => track.stop());
                        cameraModal.style.display = 'none';
                        
                        // Tampilkan notifikasi berhasil
                        alert('Foto berhasil diambil!');
                    }, 'image/jpeg', 0.8);
                });
            })
            .catch(function(error) {
                console.error('Error mengakses kamera:', error);
                alert('Tidak dapat mengakses kamera: ' + error.message);
            });
        } else {
            alert('Browser tidak mendukung akses kamera');
        }
    });
    </script>
</body>
</html>
