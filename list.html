<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Daftar Hasil Sensus Pokok</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    td.blok-cell { color: blue; text-decoration: underline; cursor: pointer; }
  </style>
</head>
<body>

<h2>Daftar Hasil Sensus Pokok</h2>
<table id="sensusTable">
  <thead>
    <tr>
      <th>Timestamp</th>
      <th>Kebun</th>
      <th>Divisi</th>
      <th>Blok</th>
      <th>Data</th>
      <th>Nama File</th>
      <th>Link</th>
      <th>Folder Path</th>
    </tr>
  </thead>
  <tbody>
    <!-- Data akan diisi lewat JavaScript -->
  </tbody>
</table>

<script>
  // ID Google Sheet dan format output publik (harus dipublish via "File > Share > Publish to web")
  const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRf9h9rK6QvmcOiCtaL.../pub?output=csv";

  fetch(SHEET_URL)
    .then(res => res.text())
    .then(csv => {
      const rows = csv.split("\n").slice(1); // skip header
      const tableBody = document.querySelector("#sensusTable tbody");
      const allData = [];

      rows.forEach(row => {
        const cols = row.split(",");
        if (cols.length < 8) return;

        const tr = document.createElement("tr");
        cols.forEach((col, i) => {
          const td = document.createElement("td");
          td.innerHTML = i === 6 ? `<a href="${col}" target="_blank">Link</a>` : col;
          if (i === 3) td.classList.add("blok-cell");
          tr.appendChild(td);
        });

        allData.push({ kebun: cols[1], divisi: cols[2], blok: cols[3], all: cols });
        tableBody.appendChild(tr);
      });

      // Klik pada kolom BLOK
      document.querySelectorAll(".blok-cell").forEach(td => {
        td.addEventListener("click", function () {
          const blokClicked = this.textContent.trim();
          const filtered = allData.filter(row => row.blok === blokClicked);

          const html = filtered.map(row => `
            <p>
              <b>Kebun:</b> ${row.kebun}<br>
              <b>Divisi:</b> ${row.divisi}<br>
              <b>Blok:</b> ${row.blok}<br>
              <b>File:</b> ${row.all[5]}<br>
              <b>Link:</b> <a href="${row.all[6]}" target="_blank">${row.all[6]}</a><br>
              <b>Folder Path:</b> ${row.all[7]}
            </p>
            <hr>
          `).join('');

          const popup = window.open("", "detail", "width=600,height=500");
          popup.document.write(`<html><head><title>Detail Blok</title></head><body>${html}</body></html>`);
        });
      });
    });
</script>

</body>
</html>
