<!DOCTYPE html>
<html>
<head>
  <title>GPX Waypoints</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    #map { 
      height: 600px; width: 100%; 
    }
    .leaflet-marker-icon.circle-icon {
      border-radius: 50% !important;
      border: 1px solid #555;
      object-fit: cover;
      background: white;
      width: 24px !important;
      height: 24px !important;
    }
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.7.0/gpx.min.js"></script>

<script>
  const map = L.map('map').setView([1.17, 100.99], 17);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Koperasi Produsen Air Kehidupan'
  }).addTo(map);

  function getWaypointIcon(symbol) {
    const sym = (symbol || '').toLowerCase().trim();
    let iconUrl = 'https://kopairkehidupan.github.io/gpsduri/blue-flag-cropped.png';
    if (sym === 'flag, green') {
      iconUrl = 'https://kopairkehidupan.github.io/gpsduri/green-flag-cropped.png';
    } else if (sym === 'navaid, black') {
      iconUrl = 'https://kopairkehidupan.github.io/gpsduri/black-flag-cropped.png';
    }
    return new L.Icon({
      iconUrl,
      iconSize: [20, 20],
      iconAnchor: [10, 10],
      popupAnchor: [0, -10]
    });
  }

  fetch('Waypoints_17-06-25.gpx')
    .then(response => response.text())
    .then(gpxText => {
      const parser = new DOMParser();
      const xml = parser.parseFromString(gpxText, "application/xml");
      const waypoints = xml.getElementsByTagName('wpt');

      if (waypoints.length === 0) {
        console.warn('No <wpt> found in GPX');
        return;
      }

      const bounds = [];

      for (let wpt of waypoints) {
        const lat = parseFloat(wpt.getAttribute('lat'));
        const lon = parseFloat(wpt.getAttribute('lon'));
        const name = wpt.getElementsByTagName('name')[0]?.textContent || 'Unknown';
        const sym = wpt.getElementsByTagName('sym')[0]?.textContent || '';

        const marker = L.marker([lat, lon], {
          icon: getWaypointIcon(sym)
        }).addTo(map);

        marker.bindPopup(`<b>Waypoint:</b> ${name}<br><b>Symbol:</b> ${sym}`);
        bounds.push([lat, lon]);
      }

      if (bounds.length) {
        map.fitBounds(bounds);
      }

      console.log("Waypoint markers added:", bounds.length);
    })
    .catch(err => {
      console.error("Failed to load GPX:", err);
    });
</script>

</body>
</html>
