<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Upload GPS ke Google Drive</title>
</head>
<body>
  <h2>Form Upload Waypoint & Track GPS</h2>

  <form id="uploadForm">
    <label>Kebun:</label>
    <input type="text" id="kebun" required><br><br>

    <label>Divisi:</label>
    <input type="text" id="divisi" required><br><br>

    <label>Blok:</label>
    <input type="text" id="blok" required><br><br>

    <label>Waypoint File:</label>
    <input type="file" id="waypoint" accept=".gpx,.kml" required><br><br>

    <label>Track File:</label>
    <input type="file" id="track" accept=".gpx,.kml" required><br><br>

    <button type="submit">Upload</button>
  </form>

  <script>
    async function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(',')[1]); // remove prefix
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    document.getElementById("uploadForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const kebun = document.getElementById("kebun").value;
      const divisi = document.getElementById("divisi").value;
      const blok = document.getElementById("blok").value;
      const waypointFile = document.getElementById("waypoint").files[0];
      const trackFile = document.getElementById("track").files[0];

      const waypointBase64 = await fileToBase64(waypointFile);
      const trackBase64 = await fileToBase64(trackFile);

      const payload = {
        kebun,
        divisi,
        blok,
        waypointName: waypointFile.name,
        waypointData: waypointBase64,
        trackName: trackFile.name,
        trackData: trackBase64
      };

      const response = await fetch("https://script.google.com/macros/s/AKfycbwJn8kI3ZjrUqMSzxZKMpsBO7nckI7uxt_epz1J0gZqD_OFq6nBFcGpyBhjM1hY9bzpAQ/exec", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const result = await response.text();
      alert(result);
    });
  </script>
</body>
</html>
